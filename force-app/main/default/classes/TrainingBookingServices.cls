//Generated by wsdl2apex

public class TrainingBookingServices {
    public class TrainingBookingAddress {
        public String Salutation;
        public String Contact;
        public String Email;
        public String Phone;
        public String Company;
        public String Street;
        public String City;
        public String Region;
        public String Postcode;
        public String Country;
        public String VatNumber;
        public String LocalTaxNo;
        public Boolean Overseas;
        private String[] Salutation_type_info = new String[]{'Salutation','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Contact_type_info = new String[]{'Contact','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Email_type_info = new String[]{'Email','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Phone_type_info = new String[]{'Phone','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Company_type_info = new String[]{'Company','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Street_type_info = new String[]{'Street','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] City_type_info = new String[]{'City','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Region_type_info = new String[]{'Region','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Postcode_type_info = new String[]{'Postcode','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Country_type_info = new String[]{'Country','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] VatNumber_type_info = new String[]{'VatNumber','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] LocalTaxNo_type_info = new String[]{'LocalTaxNo','http://www.w3.org/2001/XMLSchema','string','0','1','false'}; //JS added 12062015
        private String[] Overseas_type_info = new String[]{'Overseas','http://www.w3.org/2001/XMLSchema','boolean','1','1','false'};
        private String[] apex_schema_type_info = new String[]{'https://pgplus.bsigroup.com/','true','false'};
        private String[] field_order_type_info = new String[]{'Salutation','Contact','Email','Phone','Company','Street','City','Region','Postcode','Country','VatNumber','LocalTaxNo','Overseas'};
    }
    public class CreateOrderResponse_element {
        public TrainingBookingServices.CreateOrderResult CreateOrderResult;
        private String[] CreateOrderResult_type_info = new String[]{'CreateOrderResult','https://pgplus.bsigroup.com/','CreateOrderResult','0','1','false'};
        private String[] apex_schema_type_info = new String[]{'https://pgplus.bsigroup.com/','true','false'};
        private String[] field_order_type_info = new String[]{'CreateOrderResult'};
    }
    public class CreateOrder_element {
        public String sapTarget;
        public Boolean calculateOnly;
        public TrainingBookingServices.TrainingBookingOrder order;
        public TrainingBookingServices.TrainingBookingAddress shipTo;
        public TrainingBookingServices.TrainingBookingAddress soldTo;
        public TrainingBookingServices.ArrayOfTrainingBookingItem items;
        private String[] sapTarget_type_info = new String[]{'sapTarget','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] calculateOnly_type_info = new String[]{'calculateOnly','http://www.w3.org/2001/XMLSchema','boolean','1','1','false'};
        private String[] order_type_info = new String[]{'order','https://pgplus.bsigroup.com/','TrainingBookingOrder','0','1','false'};
        private String[] shipTo_type_info = new String[]{'shipTo','https://pgplus.bsigroup.com/','TrainingBookingAddress','0','1','false'};
        private String[] soldTo_type_info = new String[]{'soldTo','https://pgplus.bsigroup.com/','TrainingBookingAddress','0','1','false'};
        private String[] items_type_info = new String[]{'items','https://pgplus.bsigroup.com/','ArrayOfTrainingBookingItem','0','1','false'};
        private String[] apex_schema_type_info = new String[]{'https://pgplus.bsigroup.com/','true','false'};
        private String[] field_order_type_info = new String[]{'sapTarget','calculateOnly','order','shipTo','soldTo','items'};
    }
    public class CreateOrderResult {
        public Boolean Success;
        public String Messages;
        public Decimal Net;
        public Decimal Tax;
        public Decimal Gross;
        public String SapOrderNo;
        private String[] Success_type_info = new String[]{'Success','http://www.w3.org/2001/XMLSchema','boolean','1','1','false'};
        private String[] Messages_type_info = new String[]{'Messages','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Net_type_info = new String[]{'Net','http://www.w3.org/2001/XMLSchema','decimal','1','1','false'};
        private String[] Tax_type_info = new String[]{'Tax','http://www.w3.org/2001/XMLSchema','decimal','1','1','false'};
        private String[] Gross_type_info = new String[]{'Gross','http://www.w3.org/2001/XMLSchema','decimal','1','1','false'};
        private String[] SapOrderNo_type_info = new String[]{'SapOrderNo','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] apex_schema_type_info = new String[]{'https://pgplus.bsigroup.com/','true','false'};
        private String[] field_order_type_info = new String[]{'Success','Messages','Net','Tax','Gross','SapOrderNo'};
    }
public class TrainingBookingServiceSoap {
        //public String endpoint_x = 'https://pgplus.bsigroup.com/TrainingBookingServicesTest/TrainingBookingService.asmx'; //JS added 12062015
        //public String endpoint_x = 'https://pgplus.bsigroup.com/TrainingBookingServices/TrainingBookingService.asmx'; //18-10-2018 PC
        public String endpoint_x = bg_CustomSettingsUtils.GetSystemSettings().Pointglobal_TrainingBookingService__c;
        public Map<String,String> inputHttpHeaders_x;
        public Map<String,String> outputHttpHeaders_x;
        public String clientCertName_x;
        public String clientCert_x;
        public String clientCertPasswd_x;
        public Integer timeout_x;
        public TrainingBookingServices.AuthenticationHeader AuthenticationHeader;
        private String AuthenticationHeader_hns = 'AuthenticationHeader=https://pgplus.bsigroup.com/';
        private String[] ns_map_type_info = new String[]{'https://pgplus.bsigroup.com/', 'TrainingBookingServices'};
        public TrainingBookingServices.CreateOrderResult CreateOrder(String sapTarget,Boolean calculateOnly,TrainingBookingServices.TrainingBookingOrder order,TrainingBookingServices.TrainingBookingAddress shipTo,TrainingBookingServices.TrainingBookingAddress soldTo,TrainingBookingServices.ArrayOfTrainingBookingItem items) {
            TrainingBookingServices.CreateOrder_element request_x = new TrainingBookingServices.CreateOrder_element();
            TrainingBookingServices.CreateOrderResponse_element response_x;
            request_x.sapTarget = sapTarget;
            request_x.calculateOnly = calculateOnly;
            request_x.order = order;
            request_x.shipTo = shipTo;
            request_x.soldTo = soldTo;
            request_x.items = items;
            Map<String, TrainingBookingServices.CreateOrderResponse_element> response_map_x = new Map<String, TrainingBookingServices.CreateOrderResponse_element>();
            response_map_x.put('response_x', response_x);

                              System.debug('### shipTo ' + shipTo);
                              System.debug('### soldTo ' + soldTo);

            // Added to provide test coverage - MPK
            if(Test.isRunningTest())
            {
                // Build a test result
                TrainingBookingServices.CreateOrderResult testResult = new TrainingBookingServices.CreateOrderResult();
                testResult.Success = true;
                testResult.Messages = 'Test messages';
                testResult.Net = 100.00;
                testResult.Tax = 0.00;
                testResult.Gross = 100.00;
                testResult.SapOrderNo = '12345678';
                response_x = new TrainingBookingServices.CreateOrderResponse_element();
                response_x.CreateOrderResult = testResult;
            }
            else
            {
                WebServiceCallout.invoke(
                  this,
                  request_x,
                  response_map_x,
                  new String[]{endpoint_x,
                  'https://pgplus.bsigroup.com/CreateOrder',
                  'https://pgplus.bsigroup.com/',
                  'CreateOrder',
                  'https://pgplus.bsigroup.com/',
                  'CreateOrderResponse',
                  'TrainingBookingServices.CreateOrderResponse_element'}
                );
                response_x = response_map_x.get('response_x');
            }
            return response_x.CreateOrderResult;
        }
    }
    public class TrainingBookingItem {
        public String Description;
        public String Material;
        public Decimal Quantity;
        public Decimal Price;
        public Decimal Discount;
        public String Currency_x;
        public String SmoNumber;
        public String Delegates;
        private String[] Description_type_info = new String[]{'Description','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Material_type_info = new String[]{'Material','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Quantity_type_info = new String[]{'Quantity','http://www.w3.org/2001/XMLSchema','decimal','1','1','false'};
        private String[] Price_type_info = new String[]{'Price','http://www.w3.org/2001/XMLSchema','decimal','1','1','false'};
        private String[] Discount_type_info = new String[]{'Discount','http://www.w3.org/2001/XMLSchema','decimal','1','1','false'};
        private String[] Currency_x_type_info = new String[]{'Currency','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] SmoNumber_type_info = new String[]{'SmoNumber','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Delegates_type_info = new String[]{'Delegates','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] apex_schema_type_info = new String[]{'https://pgplus.bsigroup.com/','true','false'};
        private String[] field_order_type_info = new String[]{'Description','Material','Quantity','Price','Discount','Currency_x','SmoNumber','Delegates'};
    }
    public class ArrayOfTrainingBookingItem {
        public TrainingBookingServices.TrainingBookingItem[] TrainingBookingItem;
        private String[] TrainingBookingItem_type_info = new String[]{'TrainingBookingItem','https://pgplus.bsigroup.com/','TrainingBookingItem','0','-1','true'};
        private String[] apex_schema_type_info = new String[]{'https://pgplus.bsigroup.com/','true','false'};
        private String[] field_order_type_info = new String[]{'TrainingBookingItem'};
    }
    public class TrainingBookingOrder {
        public String SalesOrg;
        public String Currency_x;
        public String Language;
        public String PoNumber;
        public String OrderNumber;
        public DateTime OrderDate;
        public DateTime StartDate;
        public DateTime EndDate;
        public String CcAuthorisedType;
        public String CcAuthorisedName;
        public DateTime CcAuthorisedDate;
        public Decimal CcAuthorisedAmount;
        public String CcAuthorisationNo;
        private String[] SalesOrg_type_info = new String[]{'SalesOrg','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Currency_x_type_info = new String[]{'Currency','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Language_type_info = new String[]{'Language','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] PoNumber_type_info = new String[]{'PoNumber','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] OrderNumber_type_info = new String[]{'OrderNumber','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] OrderDate_type_info = new String[]{'OrderDate','http://www.w3.org/2001/XMLSchema','dateTime','1','1','false'};
        private String[] StartDate_type_info = new String[]{'StartDate','http://www.w3.org/2001/XMLSchema','dateTime','1','1','false'};
        private String[] EndDate_type_info = new String[]{'EndDate','http://www.w3.org/2001/XMLSchema','dateTime','1','1','false'};
        private String[] CcAuthorisedType_type_info = new String[]{'CcAuthorisedType','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] CcAuthorisedName_type_info = new String[]{'CcAuthorisedName','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] CcAuthorisedDate_type_info = new String[]{'CcAuthorisedDate','http://www.w3.org/2001/XMLSchema','dateTime','1','1','false'};
        private String[] CcAuthorisedAmount_type_info = new String[]{'CcAuthorisedAmount','http://www.w3.org/2001/XMLSchema','decimal','1','1','false'};
        private String[] CcAuthorisationNo_type_info = new String[]{'CcAuthorisationNo','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] apex_schema_type_info = new String[]{'https://pgplus.bsigroup.com/','true','false'};
        private String[] field_order_type_info = new String[]{'SalesOrg','Currency_x','Language','PoNumber','OrderNumber','OrderDate','StartDate','EndDate','CcAuthorisedType','CcAuthorisedName','CcAuthorisedDate','CcAuthorisedAmount','CcAuthorisationNo'};
    }
    public class AuthenticationHeader {
        public String UserName;
        public String Password;
        private String[] UserName_type_info = new String[]{'UserName','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] Password_type_info = new String[]{'Password','http://www.w3.org/2001/XMLSchema','string','0','1','false'};
        private String[] apex_schema_type_info = new String[]{'https://pgplus.bsigroup.com/','true','false'};
        private String[] field_order_type_info = new String[]{'UserName','Password'};
    }

    /**
    * @author Buddy Winter <buddy.winter@cloudshiftgroup.com>
    * @date 2021-10-18
    * @group CloudShiftGroup
    * @description Test class for StarRezCalloutUtil
    *
    * Date              Author              Change Description
    * -----------------------------------------------------------------------------------
    * 18/10/2021        Buddy Winter        Class modified to support transition to REST endpoint call for Training Bookings
    */
    public class TrainingBookingServiceREST {
        Map<String, Object> requestMap;

        public Integer timeout = 60000;
        public TrainingBookingServices.CreateOrderResult CreateOrder(String sapTarget,Boolean calculateOnly,TrainingBookingServices.TrainingBookingOrder order,TrainingBookingServices.TrainingBookingAddress shipTo,TrainingBookingServices.TrainingBookingAddress soldTo,TrainingBookingServices.TrainingBookingItem[] items, String revision) {
            String authEndpoint = bg_CustomSettingsUtils.GetSystemSettings().JWT_Auth_Endpoint__c;
            String cId = bg_CustomSettingsUtils.GetSystemSettings().JWT_Client_ID__c;
            String cSecret = bg_CustomSettingsUtils.GetSystemSettings().JWT_Client_Secret__c;
            String resource = bg_CustomSettingsUtils.GetSystemSettings().JWT_Resource__c;
            HttpRequest authReq = new HttpRequest();
            authReq.setEndpoint(authEndpoint);
            authReq.setMethod('POST');
            authReq.setHeader('Content-Type', 'application/x-www-form-urlencoded');
            String authPayload = 'grant_type=client_credentials'
                                + '&client_id=' + EncodingUtil.urlEncode(cId, 'UTF-8')
                                + '&client_secret=' + EncodingUtil.urlEncode(cSecret, 'UTF-8')
                                + '&resource=' + EncodingUtil.urlEncode(resource, 'UTF-8');
            authReq.setBody(authPayload);
            Http authHttp = new Http();
            HttpResponse authResponse;
            authResponse = authHttp.send(authReq);
            String token;
            if(authResponse.getStatusCode() == 200){
                Map<String, Object> authResponseObj = (Map<String, Object>) JSON.deserializeUntyped(authResponse.getBody());
                token = (String)authResponseObj.get('access_token');
            }

            TrainingBookingServices.CreateOrder_element_REST request_x = new TrainingBookingServices.CreateOrder_element_REST();
            TrainingBookingServices.CreateOrderResponse_element response_x;
            request_x.sapTarget = sapTarget;
            request_x.calculateOnly = calculateOnly;
            request_x.order = order;
            request_x.shipTo = shipTo;
            request_x.soldTo = soldTo;
            request_x.items = items;

            String endpoint = bg_CustomSettingsUtils.GetSystemSettings().TrainingBookingService_REST_Endpoint__c;
            if(revision != null && revision != '1'){
                endpoint = endpoint.replace('zlms', 'zlms;rev=' + revision);
            }
            endpoint += calculateOnly ? '/calculate' : '/create';
            String bodyRoot;
            bodyRoot = calculateOnly ? '{\"calculateOrder":' : '{\"createOrder":';

            TrainingBookingServices.CreateOrderResult responseResult;
            HttpRequest httpReq = new HttpRequest();
            httpReq.setEndpoint(endpoint);
            httpReq.setHeader('mode', 'normal');
            httpReq.setHeader('Content-Type', 'application/json');
            httpReq.setHeader('Ocp-Apim-Subscription-Key', bg_CustomSettingsUtils.GetSystemSettings().TrainingBookingService_REST_Key__c);
            httpReq.setHeader('Authorization', 'Bearer ' + token);
            httpReq.setMethod('POST');

            requestMap = (Map<String, Object>)JSON.deserializeUntyped(JSON.serialize(request_x));
            System.debug(JSON.serializePretty(requestMap));
            removeAttributes(requestMap);

            String orderDetailsBody = JSON.serialize(requestMap).replaceAll('Currency_x', 'Currency');
            String requestBody = bodyRoot + orderDetailsBody + '}';
            httpReq.setBody(requestBody);
            httpReq.setTimeout(timeout);
            String json1 = JSON.serializePretty(JSON.deserializeUntyped(requestBody));
            System.debug(json1);
            Http http = new Http();
            HttpResponse httpResponse;
            httpResponse = http.send(httpReq);
            if(httpResponse.getStatusCode() == 200){
                String responseBody = httpResponse.getBody();
                System.debug('responseBody');
                System.debug(responseBody);
                responseBody = responseBody.replaceAll('"return":', '"return_x":');
                responseBody = responseBody.replaceAll('"NUMBER":', '"NUMBER_x":');
                responseBody = responseBody.replaceAll('"SYSTEM":', '"SYSTEM_x":');
                TrainingBookingServices.rest_response_parse parsedResponse = (TrainingBookingServices.rest_response_parse) JSON.deserialize(responseBody, TrainingBookingServices.rest_response_parse.class);
                responseResult = new TrainingBookingServices.CreateOrderResult();
                responseResult.Success = true;
                responseResult.Messages = String.join(parsedResponse.ZLMS_BAPI_SALESORDER_CREATE.response.return_x.messages, ',');
                responseResult.Net = Decimal.valueOf(parsedResponse.ZLMS_BAPI_SALESORDER_CREATE.response.output.netAmount);
                responseResult.Tax = Decimal.valueOf(parsedResponse.ZLMS_BAPI_SALESORDER_CREATE.response.output.taxAmount);
                responseResult.SapOrderNo = parsedResponse.ZLMS_BAPI_SALESORDER_CREATE.response.output.documentNumber;
            } else {
                System.debug('TrainingBookingServices callout failure');
                System.debug(httpResponse.getBody());
                // throw exception
            }
            return responseResult;
        }

        /*
        * Strip any SOAP x_type_info from wrapper classes to allow to parse into JSON for SOAP call
        */
        private void removeAttributes(Map<String,Object> jsonObj)  {
            for(String key : jsonObj.keySet()) {
                if(key.endsWith('_type_info')) {
                    jsonObj.remove(key);
                } else {
                    if(jsonObj.get(key) != null && jsonObj.get(key) instanceof Map<String,Object>) {
                        removeAttributes((Map<String,Object>)jsonObj.get(key));
                    }
                    if(jsonObj.get(key) != null && jsonObj.get(key) instanceof List<Object>) {
                        for(Object listItem : (List<Object>)jsonObj.get(key)) {
                            if(listItem != null && listItem instanceof Map<String,Object>)  {
                                removeAttributes((Map<String,Object>)listItem);
                            }
                        }
                    }
                }
            }
        }
    }

    public class CreateOrder_element_REST {
        public String sapTarget;
        public Boolean calculateOnly;
        public TrainingBookingServices.TrainingBookingOrder order;
        public TrainingBookingServices.TrainingBookingAddress shipTo;
        public TrainingBookingServices.TrainingBookingAddress soldTo;
        public TrainingBookingServices.TrainingBookingItem[] items;
    }

    /* Inner classes for JSON Response Parsing */
    public class rest_response_parse {
		public res_ZLMS_BAPI_SALESORDER_CREATE ZLMS_BAPI_SALESORDER_CREATE;
	}
    public class res_ZLMS_BAPI_SALESORDER_CREATE {
		public res_response response;
	}
	public class res_response {
		public res_return return_x;
		public res_output output;
	}
	public class res_return {
		public res_raw[] raw;
		public String[] messages;
	}
	public class res_raw {
		public String TYPE;
		public String ID;
		public String NUMBER_x;
		public String MESSAGE;
		public String LOG_NO;
		public String LOG_MSG_NO;
		public String MESSAGE_V1;
		public String MESSAGE_V2;
		public String MESSAGE_V3;
		public String MESSAGE_V4;
		public String PARAMETER;
		public String ROW;
		public String FIELD;
		public String SYSTEM_x;
	}
	public class res_output {
		public String documentNumber;
		public String taxAmount;
		public String netAmount;
	}


}